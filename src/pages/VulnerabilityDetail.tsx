import { useParams, Link as RouterLink } from 'react-router-dom'
import {
  Box,
  Heading,
  Text,
  Stack,
  Badge,
  Link,
  Button,
} from '@chakra-ui/react'
import { useAppSelector } from '@/app/hooks'

const VulnerabilityDetails = () => {
  const { cve } = useParams<{ cve: string }>()
  const vulnerabilities = useAppSelector((state) => state.vulnerabilities.flattened)
  const vuln = vulnerabilities.find((v) => v.cve === cve)

  if (!vuln) {
    return (
      <Box py={10} textAlign="center">
        <Heading size="lg">Vulnerability Not Found</Heading>
        <Text>We couldn't find CVE: {cve}</Text>
        <Button mt={4} as={RouterLink} to="/vulnerabilities" variant="link" colorScheme="blue">
          Back to List
        </Button>
      </Box>
    )
  }

  return (
    <Box maxW="3xl" mx="auto" py={10}>
      <Stack spacing={4}>
        <Heading>{vuln.cve}</Heading>
        <Badge colorScheme="red" fontSize="md" width="fit-content">
          Severity: {vuln.severity.toUpperCase()}
        </Badge>
        <Text>{vuln.description || 'No description provided.'}</Text>

        <Box>
          <Text fontWeight="medium">Package</Text>
          <Text>{vuln.packageName} {vuln.packageVersion}</Text>
        </Box>

        <Box>
          <Text fontWeight="medium">Image</Text>
          <Text>{vuln.imageName}:{vuln.imageVersion}</Text>
        </Box>

        <Box>
          <Text fontWeight="medium">Status</Text>
          <Text>{vuln.status}</Text>
        </Box>

        {vuln.link && (
          <Box>
            <Text fontWeight="medium">Reference</Text>
            <Link href={vuln.link} isExternal color="blue.500">
              {vuln.link}
            </Link>
          </Box>
        )}

        <Button as={RouterLink} to="/vulnerabilities" colorScheme="blue" mt={4} style={{maxWidth: 'fit-content'}}>
          ‚Üê Back to Vulnerabilities
        </Button>
      </Stack>
    </Box>
  )
}

export default VulnerabilityDetails
